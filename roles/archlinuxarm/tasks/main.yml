---
# tasks file for archlinuxarm

- name: Remove Geo-IP based Pacman mirror
  replace:
    path: /etc/pacman.d/mirrorlist
    regexp: '^(Server\s*=\s*http://mirror\.archlinuxarm\.org/.*)$'
    replace: '# \1'


- name: Enable European Pacman mirrors
  replace:
    path: /etc/pacman.d/mirrorlist
    regexp: '^#\s*(Server\s*=\s*http://{{item}}\.mirror\.archlinuxarm\.org/.*)$'
    replace: '\1'
  loop:
    - dk
    - fr
    - de
    - de3
    - nl


- name: Disable DNSSec
  lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: '^#DNSSEC='
    line: DNSSEC=false
  notify: restart-systemd-resolved


- name: Update system
  pacman:
    update_cache: yes
    upgrade: yes


- name: Install packages
  pacman:
    name:
      - file
      - base-devel
      - git
      - python-pip
      - vim
    state: present


- name: Install GPIO reset script
  copy:
    src: files/scripts/reset-gpio.sh
    dest: /usr/local/bin
    owner: root
    group: root
    mode: "0755"

